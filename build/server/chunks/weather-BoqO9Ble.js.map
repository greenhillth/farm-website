{"version":3,"file":"weather-BoqO9Ble.js","sources":["../../../.svelte-kit/adapter-node/chunks/weather.js"],"sourcesContent":["function computeVPD_c_kPa(tempC, rh) {\n  const es = 0.6108 * Math.exp(17.27 * tempC / (tempC + 237.3));\n  const ea = rh / 100 * es;\n  return Math.max(0, es - ea);\n}\nfunction mapReadingToWeather(r) {\n  const mock = getMockWeather();\n  const updatedAt = new Date(r.timestamp_utc ?? (/* @__PURE__ */ new Date()).toISOString()).toISOString();\n  const tempC = r.temp_c ?? void 0;\n  const rh = r.humidity_pct ?? void 0;\n  const vpd = tempC != null && rh != null ? computeVPD_c_kPa(tempC, rh) : mock.outdoor.vpd;\n  const dewPoint = tempC != null && rh != null ? (() => {\n    const a = 17.27;\n    const b = 237.7;\n    const alpha = a * tempC / (b + tempC) + Math.log(rh / 100);\n    return b * alpha / (a - alpha);\n  })() : mock.outdoor.dewPoint;\n  const windSpeed = r.wind_avg_ms ?? void 0;\n  const windGust = r.wind_gust_ms ?? void 0;\n  const windDir = r.wind_dir_deg ?? void 0;\n  const pressure = r.pressure_hpa ?? void 0;\n  const solar = r.solar_wm2 ?? void 0;\n  const hourlyRain = r.rain_1h_mm ?? void 0;\n  const dailyRain = r.rain_24h_mm ?? void 0;\n  return {\n    updatedAt,\n    outdoor: {\n      temp: tempC ?? mock.outdoor.temp,\n      trend: 0,\n      feelsLike: tempC ?? mock.outdoor.feelsLike,\n      dewPoint,\n      humidity: rh ?? mock.outdoor.humidity,\n      vpd\n    },\n    indoor: {\n      temp: mock.indoor.temp,\n      trend: 0,\n      humidity: mock.indoor.humidity\n    },\n    solar: {\n      solar: solar ?? mock.solar.solar,\n      uvi: mock.solar.uvi,\n      sunrise: mock.solar.sunrise,\n      sunset: mock.solar.sunset,\n      moon: mock.solar.moon\n    },\n    rain: {\n      rate: 0,\n      daily: dailyRain ?? mock.rain.daily,\n      event: mock.rain.event,\n      hourly: hourlyRain ?? mock.rain.hourly,\n      weekly: mock.rain.weekly,\n      monthly: mock.rain.monthly,\n      yearly: mock.rain.yearly\n    },\n    wind: {\n      dir: windDir ?? mock.wind.dir,\n      speed: windSpeed ?? mock.wind.speed,\n      gust: windGust ?? mock.wind.gust,\n      timeSpeed: mock.wind.timeSpeed,\n      timeGust: mock.wind.timeGust\n    },\n    pressure: {\n      rel: pressure ?? mock.pressure.rel,\n      abs: pressure ?? mock.pressure.abs,\n      deltaRel: 0,\n      deltaAbs: 0\n    },\n    battery: {\n      status: mock.battery.status,\n      note: mock.battery.note\n    },\n    series: mock.series\n  };\n}\nasync function fetchBackendWeatherMeta(apiBase) {\n  try {\n    const res = await fetch(`${apiBase.replace(/\\/$/, \"\")}/weather/current`);\n    if (!res.ok) throw new Error(`backend /weather/current failed: ${res.status}`);\n    const reading = await res.json();\n    return { data: mapReadingToWeather(reading), connected: true, source: \"ecowitt\" };\n  } catch (err) {\n    console.warn(\"[backend] Fetch failed; serving mock data\");\n    return { data: getMockWeather(), connected: false, source: \"mock\" };\n  }\n}\nfunction getMockWeather() {\n  const now = /* @__PURE__ */ new Date();\n  return {\n    updatedAt: now.toISOString(),\n    outdoor: { temp: 12.2, trend: 0.8, feelsLike: 12.2, dewPoint: 5.6, humidity: 64, vpd: 0.511 },\n    indoor: { temp: 14.5, trend: -1.4, humidity: 57 },\n    solar: { solar: 306.2, uvi: 2, sunrise: \"06:25\", sunset: \"17:57\", moon: \"Waning Gibbous\" },\n    rain: { rate: 0, daily: 0, event: 31.8, hourly: 0, weekly: 33.6, monthly: 33.6, yearly: 33.6 },\n    wind: { dir: 221, speed: 8.6, gust: 18.4, timeSpeed: \"09:46\", timeGust: \"00:07\" },\n    pressure: { rel: 993.7, abs: 993.7, deltaRel: -0.2, deltaAbs: -0.2 },\n    battery: { status: \"NORMAL\", note: \"Sensor Array\" },\n    series: Array.from({ length: 48 }).map((_, i) => ({\n      t: i,\n      temp: 6 + i * 0.12 + Math.sin(i / 3) * 0.5,\n      feels: 5.5 + i * 0.1 + Math.sin(i / 4) * 0.4,\n      dew: 3 + Math.sin(i / 5) * 0.3\n    }))\n  };\n}\nasync function fetchWeather() {\n  const { data, connected, source } = await fetchBackendWeatherMeta(\"/api\");\n  return { weather: data, connected, source };\n}\nexport {\n  fetchWeather as f\n};\n"],"names":[],"mappings":"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"}
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <base target="_parent" />
    <title>delinchous toastie!</title>

    <!-- Fonts (same as map page) -->
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap"
      rel="stylesheet"
    />

    <!-- Tailwind (built CSS) -->
    <link rel="stylesheet" href="assets/css/site.css" />

    <!-- Tiny fallback if Tailwind isn't built -->
    <style>
      html,
      body {
        height: 100%;
        margin: 0;
      }
      body {
        background: #0b1117;
        color: #e6edf3;
        font-family: Inter, system-ui, sans-serif;
      }
      .container {
        max-width: 1000px;
        margin: 0 auto;
        padding: 24px;
      }
    </style>
  </head>
  <body class="bg-bg text-text font-sans">
    <header class="container flex items-center justify-between gap-4">
      <a href="map.html" class="text-sm text-muted hover:text-white"
        >&larr; Back to map</a
      >
      <h1 class="text-lg font-semibold">shmalenks üëπüëπüëπ</h1>
      <span></span>
    </header>

    <main class="container">
      <section
        class="bg-panel border border-border rounded-xl p-4 md:p-6 shadow-sm"
      >
        <div class="relative w-full max-w-[960px] mx-auto">
          <!-- 1) Image shown first -->
          <img
            id="prankImage"
            src="assets/img/tom-and-alex.jpg"
            alt="A very normal toastie"
            class="block w-full h-auto rounded-lg border border-border transition-opacity duration-500 ease-in-out opacity-100 select-none"
          />

          <!-- 2) Video, hidden initially -->
          <video
            id="prankVideo"
            class="hidden w-full h-auto rounded-lg border border-border"
            preload="auto"
            playsinline
            controls
            poster="assets/img/tom-and-alex.jpg"
          >
            <source src="assets/video/pysn.mp4" type="video/mp4" />
            Sorry, your browser can‚Äôt play this video.
          </video>

          <!-- 3) Fallback overlay for browsers that block autoplay with sound -->
          <button
            id="unmuteOverlay"
            class="hidden absolute inset-0 m-auto h-12 w-56 rounded-full bg-white/10 hover:bg-white/20 text-white border border-border backdrop-blur-sm shadow focus:outline-none focus:ring-2 focus:ring-accent/50"
          >
            ‚ñ∂ Play with sound
          </button>
        </div>
        <p class="text-sm text-muted mt-3">nothing to see here!</p>
      </section>
    </main>

    <script>
      (function () {
        const img = document.getElementById("prankImage");
        const vid = document.getElementById("prankVideo");
        const overlay = document.getElementById("unmuteOverlay");

        // After ~3s, fade image out and swap to video
        setTimeout(async () => {
          try {
            // Swap visibility
            img.classList.add("opacity-0");
            setTimeout(() => {
              img.classList.add("hidden");
              vid.classList.remove("hidden");
            }, 220);

            // Try to play WITH sound
            vid.muted = false;
            vid.currentTime = 0;
            await vid.play(); // most browsers will block if no prior gesture
          } catch (err) {
            // Autoplay with audio blocked -> play muted, ask for a quick click/tap
            try {
              vid.muted = true;
              await vid.play();
            } catch (e) {
              // If even muted autoplay fails, just show controls; user will press play.
            }
            overlay.classList.remove("hidden");

            const unlock = async () => {
              try {
                vid.muted = false;
                await vid.play();
                overlay.classList.add("hidden");
              } catch (e) {
                /* ignore */
              }
              // Clean up listeners after first gesture
              document.removeEventListener("pointerdown", unlock);
              document.removeEventListener("keydown", unlock);
            };
            document.addEventListener("pointerdown", unlock, { once: true });
            document.addEventListener("keydown", unlock, { once: true });
          }
        }, 3000); // ‚Üê prank delay
      })();
    </script>
  </body>
</html>

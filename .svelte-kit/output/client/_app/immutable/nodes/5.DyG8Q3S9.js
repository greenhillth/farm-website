import"../chunks/DsnmJJEf.js";import"../chunks/KrGMG5d4.js";import{o as fe}from"../chunks/DN-rPOIK.js";import{aw as ue,A as b,af as pe,l as he,u as _,j as xe,ax as _e,p as ge,ay as ye,az as be,f,s as v,a as L,b as c,c as we,e as o,h as w,m as k,g as t,n as ke,r as l,aA as Me,G as N}from"../chunks/C0ys7KY4.js";import{s as M}from"../chunks/ClEjLSVY.js";import{i as J}from"../chunks/DAHDt1MN.js";import{e as Q,i as X}from"../chunks/BE37X3y1.js";import{r as Pe,s as Ce}from"../chunks/CauDJsBl.js";import{i as Ae}from"../chunks/CALS168o.js";import{P as j}from"../chunks/CBS-fKD7.js";import{C as $e}from"../chunks/72STO5oG.js";function Fe(e,m,g=m){var y=new WeakSet;ue(e,"input",async i=>{var r=i?e.defaultValue:e.value;if(r=K(e)?U(r):r,g(r),b!==null&&y.add(b),await pe(),r!==(r=m())){var P=e.selectionStart,h=e.selectionEnd;e.value=r??"",h!==null&&(e.selectionStart=P,e.selectionEnd=Math.min(h,e.value.length))}}),(he&&e.defaultValue!==e.value||_(m)==null&&e.value)&&(g(K(e)?U(e.value):e.value),b!==null&&y.add(b)),xe(()=>{var i=m();if(e===document.activeElement){var r=_e??b;if(y.has(r))return}K(e)&&i===U(e.value)||e.type==="date"&&!i&&!e.value||i!==e.value&&(e.value=i??"")})}function K(e){var m=e.type;return m==="number"||m==="range"}function U(e){return e===""?null:+e}var De=f('<div class="text-sm text-muted">Loading paddocks…</div>'),Se=f('<div class="text-sm text-red-400"> </div>'),Ee=f('<td class="py-2 text-right"> </td>'),Ie=f('<tr class="border-b border-border/40 hover:bg-white/5"><td class="py-2 pr-4"><div class="flex items-center gap-2"><span class="font-medium text-white"> </span> <a class="text-xs text-muted hover:text-white underline">View on map</a></div></td><td class="py-2 pr-4"> </td><td class="py-2 pr-4"> </td><!></tr>'),Oe=f('<div class="overflow-x-auto"><table class="w-full text-sm"><thead class="text-left text-muted border-b border-border/60"><tr><th class="py-2 pr-4">Name</th><th class="py-2 pr-4">Farm</th><th class="py-2 pr-4">Year</th><th class="py-2 pr-2 text-right">OM</th><th class="py-2 pr-2 text-right">P1</th><th class="py-2 pr-2 text-right">K</th><th class="py-2 pr-2 text-right">MG</th><th class="py-2 pr-2 text-right">CA</th><th class="py-2 pl-2 text-right">PH</th></tr></thead><tbody></tbody></table></div>'),Ge=f('<div class="flex items-center gap-3 mb-3"><input placeholder="Search by name or farm…" class="w-full max-w-md rounded-md border border-border bg-white/5 px-3 py-2 text-sm outline-none focus:ring-2 focus:ring-accent/40"/> <a href="/map" class="text-sm text-muted hover:text-white">Open map →</a></div> <!>',1),Le=f('<ul class="list-disc pl-5 text-sm text-muted space-y-1"><li>South paddock: inspect fence line</li> <li>North ridge: soil sampling next week</li> <li>Creek paddock: spot spray blackberry regrowth</li></ul>'),Ne=f('<ul class="list-disc pl-5 text-sm text-muted space-y-1"><li>Fertilize OM trial plots (Friday)</li> <li>Check troughs in Top Flat</li></ul>'),je=f('<header class="container mx-auto px-4 py-4 flex items-center justify-between gap-4"><a href="/" class="text-sm text-muted hover:text-white">&larr; Back to home</a> <div class="text-xs text-muted">Paddock Manager</div></header> <main class="container mx-auto px-4 pb-8 space-y-5"><!> <div class="grid gap-4 lg:grid-cols-2 xl:grid-cols-3"><!> <!></div></main>',1);function Je(e,m){ge(m,!1);const g=k(),y=["OM","P1","K","MG","CA","PH"];let i=k([]),r=k(""),P=k(!0),h=k(null);fe(async()=>{try{const s=await fetch($e.data.geojson);if(!s.ok)throw new Error(`${s.status} ${s.statusText}`);const C=await s.json();w(i,(C.features??[]).map(d=>{const a=d.properties??{};return{id:String(a.fieldID||a.ADSFLDID||a.FIELDID||crypto.randomUUID()),name:String(a.fieldName||a.FIELDNAME||"Unnamed"),farm:a.FARM??void 0,year:a.ADSYEAR??void 0,metrics:{OM:a.OM??void 0,P1:a.P1??void 0,K:a.K??void 0,MG:a.MG??void 0,CA:a.CA??void 0,PH:a.PH??void 0}}}).sort((d,a)=>d.name.localeCompare(a.name)))}catch(s){w(h,s?.message??"Failed loading paddocks")}finally{w(P,!1)}}),ye(()=>(t(r),t(i)),()=>{w(g,t(r)?t(i).filter(s=>(s.name+" "+(s.farm??"")).toLowerCase().includes(t(r).toLowerCase())):t(i))}),be(),Ae();var H=je(),R=v(L(H),2),T=o(R);j(T,{title:"Paddocks",children:(s,C)=>{var d=Ge(),a=L(d),Y=o(a);Pe(Y),ke(2),l(a);var ee=v(a,2);{var te=u=>{var A=De();c(u,A)},ae=u=>{var A=Me(),re=L(A);{var se=x=>{var p=Se(),$=o(p,!0);l(p),N(()=>M($,t(h))),c(x,p)},le=x=>{var p=Oe(),$=o(p),q=v(o($));Q(q,5,()=>t(g),X,(oe,n)=>{var F=Ie(),D=o(F),B=o(D),S=o(B),ie=o(S,!0);l(S);var de=v(S,2);l(B),l(D);var E=v(D),ne=o(E,!0);l(E);var I=v(E),ce=o(I,!0);l(I);var me=v(I);Q(me,1,()=>y,X,(O,W)=>{var G=Ee(),ve=o(G,!0);l(G),N(()=>M(ve,(t(n),t(W),_(()=>t(n).metrics[t(W)]??"-")))),c(O,G)}),l(F),N(O=>{M(ie,(t(n),_(()=>t(n).name))),Ce(de,"href",O),M(ne,(t(n),_(()=>t(n).farm??"-"))),M(ce,(t(n),_(()=>t(n).year??"-")))},[()=>(t(n),_(()=>`/map?metric=OM#${encodeURIComponent(t(n).name)}`))]),c(oe,F)}),l(q),l($),l(p),c(x,p)};J(re,x=>{t(h)?x(se):x(le,!1)},!0)}c(u,A)};J(ee,u=>{t(P)?u(te):u(ae,!1)})}Fe(Y,()=>t(r),u=>w(r,u)),c(s,d)},$$slots:{default:!0}});var V=v(T,2),z=o(V);j(z,{title:"Recent Notes",children:(s,C)=>{var d=Le();c(s,d)},$$slots:{default:!0}});var Z=v(z,2);j(Z,{title:"Upcoming Tasks",children:(s,C)=>{var d=Ne();c(s,d)},$$slots:{default:!0}}),l(V),l(R),c(e,H),we()}export{Je as component};
